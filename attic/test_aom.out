#INFO: **** input file is /home/jluis/tmp/pyaim/test_aom.py ****
#!/usr/bin/env python

import numpy
from pyscf import gto, scf, lib, ao2mo

mol = gto.Mole()
mol.atom = '''
O      0.000000      0.000000      0.118351
H      0.000000      0.761187     -0.469725
H      0.000000     -0.761187     -0.469725
    '''
mol.basis = 'sto-6g'
mol.verbose = 4
mol.spin = 0
mol.symmetry = 1
mol.charge = 0
mol.build()

mf = scf.RHF(mol)
ehf = mf.kernel()
nao = mol.nao_nr()
dm = mf.make_rdm1()

s = mol.intor('int1e_ovlp')
t = mol.intor('int1e_kin')
v = mol.intor('int1e_nuc')

enuc = mol.energy_nuc() 
ekin = numpy.einsum('ij,ji->',t,dm)
pop = numpy.einsum('ij,ji->',s,dm)
elnuce = numpy.einsum('ij,ji->',v,dm)
lib.logger.info(mf,'* Info on AO basis')
lib.logger.info(mf,'Population : %12.6f' % pop)
lib.logger.info(mf,'Kinetic energy : %12.6f' % ekin)
lib.logger.info(mf,'Nuclear Atraction energy : %12.6f' % elnuce)
lib.logger.info(mf,'Nuclear Repulsion energy : %12.6f' % enuc)

nmo = mf.mo_coeff.shape[1]
coeff = mf.mo_coeff[:,:nmo]
rdm1 = numpy.zeros((nmo,nmo))
for i in range(mol.nelectron//2):
    rdm1[i,i] = 2.0

s = coeff.T.dot(s).dot(coeff)
t = coeff.T.dot(t).dot(coeff)
v = coeff.T.dot(v).dot(coeff)
ekin = numpy.einsum('ij,ji->',t,rdm1)
pop = numpy.einsum('ij,ji->',s,rdm1)
elnuce = numpy.einsum('ij,ji->',v,rdm1)
lib.logger.info(mf,'* Info on MO basis')
lib.logger.info(mf,'Population : %12.6f' % pop)
lib.logger.info(mf,'Kinetic energy : %12.6f' % ekin)
lib.logger.info(mf,'Nuclear Atraction energy : %12.6f' % elnuce)
lib.logger.info(mf,'Nuclear Repulsion energy : %12.6f' % enuc)

coeff = numpy.linalg.inv(coeff)
s = coeff.T.dot(s).dot(coeff)
t = coeff.T.dot(t).dot(coeff)
v = coeff.T.dot(v).dot(coeff)
ekin = numpy.einsum('ij,ji->',t,dm)
pop = numpy.einsum('ij,ji->',s,dm)
elnuce = numpy.einsum('ij,ji->',v,dm)
lib.logger.info(mf,'* Backtransform from MO to AO basis')
lib.logger.info(mf,'Population : %12.6f' % pop)
lib.logger.info(mf,'Kinetic energy : %12.6f' % ekin)
lib.logger.info(mf,'Nuclear Atraction energy : %12.6f' % elnuce)
lib.logger.info(mf,'Nuclear Repulsion energy : %12.6f' % enuc)

#INFO: ******************** input file end ********************


System: ('Linux', 'cromo', '4.9.0-0.bpo.3-amd64', '#1 SMP Debian 4.9.30-2+deb9u5~bpo8+1 (2017-09-28)', 'x86_64', '')  Threads 4
Python 2.7.14 (default, Apr 10 2018, 19:21:27) 
[GCC 7.3.0]
numpy 1.15.4  scipy 1.2.0
Date: Thu Dec 27 21:00:19 2018
PySCF version 1.6b
PySCF path  /home/jluis/src/pyscf/dev/pyscf
GIT ORIG_HEAD 26de5e7c8230210833f9d25fbbcde03cf2076fdc
GIT HEAD      ref: refs/heads/dev
GIT dev branch  21b86f213f74edcb007f36d31e83475226de7b3a

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_TMPDIR /scratch-ssd/jluis
[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 3
[INPUT] num. electrons = 10
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry 1 subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 O      0.000000000000   0.000000000000   0.117615200000 AA    0.000000000000   0.000000000000   0.222260516086 Bohr
[INPUT]  2 H      0.761187000000   0.000000000000  -0.470460800000 AA    1.438434959579   0.000000000000  -0.889042064344 Bohr
[INPUT]  3 H     -0.761187000000   0.000000000000  -0.470460800000 AA   -1.438434959579   0.000000000000  -0.889042064344 Bohr

nuclear repulsion = 9.14985900416406
point group symmetry = C2v
num. orbitals of irrep A1 = 4
num. orbitals of irrep B1 = 2
num. orbitals of irrep B2 = 1
number of shells = 5
number of NR pGTOs = 42
number of NR cGTOs = 7
basis = sto-6g
ecp = {}
CPU time:         0.38


******** <class 'pyscf.scf.hf_symm.SymAdaptedRHF'> ********
method = SymAdaptedRHF-RHF
initial guess = minao
damping factor = 0
level shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
DIIS start cycle = 1
DIIS space = 8
SCF tol = 1e-09
SCF gradient tol = None
max. SCF cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /scratch-ssd/jluis/tmpVEnf6K
max_memory 32000 MB (current use 73 MB)
Freeze 0 electrons in irreps []
    10 free electrons in irreps A1 B1 B2
Set gradient conv threshold to 3.16228e-05
init E= -75.5593991587266
HOMO (B2) = -0.397741781741029  LUMO (A1) = 0.414347336914795
cycle= 1 E= -75.6285509264716  delta_E= -0.0692  |g|= 0.37  |ddm|= 1.69
HOMO (B2) = -0.272173086469326  LUMO (A1) = 0.632234164641574
cycle= 2 E= -75.6786170586972  delta_E= -0.0501  |g|= 0.0437  |ddm|= 0.563
HOMO (B2) = -0.395203349541153  LUMO (A1) = 0.592838660801434
cycle= 3 E= -75.6791509537189  delta_E= -0.000534  |g|= 0.00882  |ddm|= 0.0442
HOMO (B2) = -0.397054903046291  LUMO (A1) = 0.592734158909679
cycle= 4 E= -75.6791803635173  delta_E= -2.94e-05  |g|= 9.44e-05  |ddm|= 0.0159
HOMO (B2) = -0.397035829119934  LUMO (A1) = 0.5926469021789
cycle= 5 E= -75.6791803679563  delta_E= -4.44e-09  |g|= 2.66e-05  |ddm|= 0.000185
HOMO (B2) = -0.397043118633763  LUMO (A1) = 0.59265729090833
cycle= 6 E= -75.6791803685136  delta_E= -5.57e-10  |g|= 4e-06  |ddm|= 8.73e-05
HOMO (B2) = -0.39704427953666  LUMO (A1) = 0.592659142073156
Extra cycle  E= -75.6791803685238  delta_E= -1.03e-11  |g|= 1.73e-06  |ddm|= 8.91e-06
converged SCF energy = -75.6791803685238
* Info on AO basis
Population :    10.000000
Kinetic energy :    75.918415
Nuclear Atraction energy :  -199.071261
Nuclear Repulsion energy :     9.149859
* Info on MO basis
Population :    10.000000
Kinetic energy :    75.918415
Nuclear Atraction energy :  -199.071261
Nuclear Repulsion energy :     9.149859
* Backtransform from MO to AO basis
Population :    10.000000
Kinetic energy :    75.918415
Nuclear Atraction energy :  -199.071261
Nuclear Repulsion energy :     9.149859
