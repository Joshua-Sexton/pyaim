#INFO: **** input file is /home/jluis/tmp/pyaim/h2o.py ****
#!/usr/bin/env python

import numpy, time
from pyscf import gto, scf, lib, dft

name = 'h2o'

mol = gto.Mole()
mol.atom = '''
      o     0    0       0
      h     0    -.757   .587
      h     0    .757    .587
'''
mol.basis = 'aug-cc-pvqz'
mol.verbose = 4
mol.spin = 0
mol.symmetry = 1
mol.charge = 0
mol.build()

mf = dft.RKS(mol)
mf.max_cycle = 150
mf.grids.atom_grid = {'H': (20,110), 'O': (20,110)}
mf.grids.prune = None
mf.chkfile = name+'.chk'
mf.xc = 'rpw86,pbe'
mf.kernel()

dm = mf.make_rdm1()
coords = mf.grids.coords
weights = mf.grids.weights
ngrids = len(weights)
ao = dft.numint.eval_ao(mol, coords, deriv=1)
rho = dft.numint.eval_rho(mol, ao, dm, xctype='GGA')
lib.logger.info(mf,'Rho = %.12f' % numpy.einsum('i,i->', rho[0], weights))
ex, vx = dft.libxc.eval_xc('rPW86,', rho)[:2]
ec, vc = dft.libxc.eval_xc(',PBE', rho)[:2]
lib.logger.info(mf, 'Ex  = %.12f' % numpy.einsum('i,i,i->', ex, rho[0], weights))
lib.logger.info(mf, 'Ec  = %.12f' % numpy.einsum('i,i,i->', ec, rho[0], weights))
lib.logger.info(mf, 'Exc = %.12f' % numpy.einsum('i,i,i->', ex+ec, rho[0], weights))

#INFO: ******************** input file end ********************


System: ('Linux', 'cromo', '4.9.0-0.bpo.3-amd64', '#1 SMP Debian 4.9.30-2+deb9u5~bpo8+1 (2017-09-28)', 'x86_64', '')  Threads 4
Python 2.7.14 (default, Apr 10 2018, 19:21:27) 
[GCC 7.3.0]
numpy 1.15.4  scipy 1.2.0
Date: Wed Dec 26 19:34:37 2018
PySCF version 1.6b
PySCF path  /home/jluis/src/pyscf/dev/pyscf
GIT ORIG_HEAD 26de5e7c8230210833f9d25fbbcde03cf2076fdc
GIT HEAD      ref: refs/heads/dev
GIT dev branch  21b86f213f74edcb007f36d31e83475226de7b3a

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_TMPDIR /scratch-ssd/jluis
[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 3
[INPUT] num. electrons = 10
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry 1 subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 O      0.000000000000   0.000000000000  -0.117400000000 AA    0.000000000000   0.000000000000  -0.221853847024 Bohr
[INPUT]  2 H     -0.757000000000   0.000000000000   0.469600000000 AA   -1.430522676296   0.000000000000   0.887415388096 Bohr
[INPUT]  3 H      0.757000000000   0.000000000000   0.469600000000 AA    1.430522676296   0.000000000000   0.887415388096 Bohr

nuclear repulsion = 9.18825841774611
point group symmetry = C2v
num. orbitals of irrep A1 = 61
num. orbitals of irrep A2 = 27
num. orbitals of irrep B1 = 49
num. orbitals of irrep B2 = 35
number of shells = 47
number of NR pGTOs = 189
number of NR cGTOs = 172
basis = aug-cc-pvqz
ecp = {}
CPU time:         0.44


******** <class 'pyscf.dft.rks_symm.SymAdaptedRKS'> ********
method = SymAdaptedRKS-SymAdaptedRHF-RHF
initial guess = minao
damping factor = 0
level shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
DIIS start cycle = 1
DIIS space = 8
SCF tol = 1e-09
SCF gradient tol = None
max. SCF cycles = 150
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = h2o.chk
max_memory 32000 MB (current use 74 MB)
XC functionals = rpw86,pbe
radial grids: 
    Treutler-Ahlrichs (JCP 102, 346 (M4)) radial grids
    
becke partition: Becke, JCP, 88, 2547 (1988)
pruning grids: None
grids dens level: 3
symmetrized grids: 1
atomic radii adjust function: <function treutler_atomic_radii_adjust at 0x2ac69641ade8>
User specified grid scheme {'H': (20, 110), 'O': (20, 110)}
Freeze 0 electrons in irreps []
    10 free electrons in irreps A1 A2 B1 B2
Set gradient conv threshold to 3.16228e-05
tot grids = 6600
init E= -76.5609885621787
HOMO (B2) = -0.409843130991889  LUMO (A1) = -0.0487492065990105
cycle= 1 E= -76.4911254780637  delta_E= 0.0699  |g|= 0.833  |ddm|= 0.724
HOMO (B2) = -0.0837643272249648  LUMO (A1) = -0.0114428408096302
cycle= 2 E= -75.9277753077834  delta_E= 0.563  |g|= 1.87  |ddm|= 0.903
HOMO (B2) = -0.284254384570236  LUMO (A1) = -0.0392722889241378
cycle= 3 E= -76.6108192514896  delta_E= -0.683  |g|= 0.0339  |ddm|= 0.638
HOMO (B2) = -0.269607395011706  LUMO (A1) = -0.0347826189661169
cycle= 4 E= -76.6110353622929  delta_E= -0.000216  |g|= 0.00855  |ddm|= 0.0233
HOMO (B2) = -0.270772610433985  LUMO (A1) = -0.0356808127259073
cycle= 5 E= -76.6110459039885  delta_E= -1.05e-05  |g|= 0.00155  |ddm|= 0.00317
HOMO (B2) = -0.271056036528623  LUMO (A1) = -0.0358195258091956
cycle= 6 E= -76.6110463320017  delta_E= -4.28e-07  |g|= 0.000241  |ddm|= 0.000601
HOMO (B2) = -0.271100481573163  LUMO (A1) = -0.0358335293940277
cycle= 7 E= -76.6110463405379  delta_E= -8.54e-09  |g|= 9.52e-06  |ddm|= 7.9e-05
HOMO (B2) = -0.271100957862771  LUMO (A1) = -0.0358331434263695
cycle= 8 E= -76.6110463405557  delta_E= -1.78e-11  |g|= 1.81e-06  |ddm|= 4.09e-06
HOMO (B2) = -0.271101700138685  LUMO (A1) = -0.0358332696398156
Extra cycle  E= -76.6110463405537  delta_E= 2.02e-12  |g|= 3.6e-06  |ddm|= 1.94e-06
converged SCF energy = -76.6110463405537
Rho = 10.000469976678
Ex  = -9.152358695593
Ec  = -0.323777816124
Exc = -9.476136511717
