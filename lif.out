#INFO: **** input file is /home/jluis/tmp/pyaim/lif.py ****
#!/usr/bin/env python

import numpy, time, h5py, os, sys
from pyscf import gto, scf, lib, dft, ao2mo

name = 'lif'

mol = gto.Mole()
mol.atom = '''
Li      0.000000      0.000000      1.565940
F      0.000000      0.000000     -0.002040
'''
dirnow = os.path.realpath(os.path.join(__file__, '..'))
basfile = os.path.join(dirnow, 'sqzp.dat')
mol.basis = basfile
mol.verbose = 4
mol.spin = 0
mol.symmetry = 1
mol.charge = 0
mol.build()

mf = dft.RKS(mol)
mf.max_cycle = 150
#mf.grids.atom_grid = {'H': (20,110), 'O': (20,110)}
#mf.grids.prune = None
mf.chkfile = name+'.chk'
mf.xc = 'rpw86,pbe'
ehf = mf.kernel()

dm = mf.make_rdm1()
nao = mol.nao_nr()

coords = mf.grids.coords
weights = mf.grids.weights
ngrids = len(weights)
ao = dft.numint.eval_ao(mol, coords, deriv=1)
rho = dft.numint.eval_rho(mol, ao, dm, xctype='GGA')
lib.logger.info(mf,'Rho = %.12f' % numpy.einsum('i,i->', rho[0], weights))
ex, vx = dft.libxc.eval_xc('rPW86,', rho)[:2]
ec, vc = dft.libxc.eval_xc(',PBE', rho)[:2]
ex = numpy.einsum('i,i,i->', ex, rho[0], weights)
ec = numpy.einsum('i,i,i->', ec, rho[0], weights)

s = mol.intor('int1e_ovlp')
t = mol.intor('int1e_kin')
v = mol.intor('int1e_nuc')
eri_ao = ao2mo.restore(1,mf._eri,nao)
eri_ao = eri_ao.reshape(nao,nao,nao,nao)

enuc = mol.energy_nuc() 
ekin = numpy.einsum('ij,ji->',t,dm)
pop = numpy.einsum('ij,ji->',s,dm)
elnuce = numpy.einsum('ij,ji->',v,dm)
lib.logger.info(mf,'Population : %12.6f' % pop)
lib.logger.info(mf,'Kinetic energy : %12.6f' % ekin)
lib.logger.info(mf,'Nuclear Atraction energy : %12.6f' % elnuce)
lib.logger.info(mf,'Nuclear Repulsion energy : %12.6f' % enuc)
bie1 = numpy.einsum('ijkl,ij,kl->',eri_ao,dm,dm)*0.5 # J
bie2 = numpy.einsum('ijkl,il,jk->',eri_ao,dm,dm)*0.25 # XC
pairs1 = numpy.einsum('ij,kl,ij,kl->',dm,dm,s,s) # J
pairs2 = numpy.einsum('ij,kl,li,kj->',dm,dm,s,s)*0.5 # XC
pairs = (pairs1 - pairs2)
lib.logger.info(mf,'Coulomb Pairs : %12.6f' % (pairs1))
lib.logger.info(mf,'XC Pairs : %12.6f' % (pairs2))
lib.logger.info(mf,'Pairs : %12.6f' % pairs)
lib.logger.info(mf,'J energy : %12.6f' % bie1)
lib.logger.info(mf,'XC energy : %12.6f' % -bie2)
lib.logger.info(mf,'EE energy : %12.6f' % (bie1-bie2))
etot = enuc + ekin + elnuce + bie1 - bie2
lib.logger.info(mf,'HF Total energy : %12.6f' % etot)
lib.logger.info(mf,'Ex : %12.6f' % ex)
lib.logger.info(mf,'Ec : %12.6f' % ec)
lib.logger.info(mf,'Exc : %12.6f' % (ex+ec))
etot = enuc + ekin + elnuce + bie1 + ex + ec
lib.logger.info(mf,'DFT Total energy : %12.6f' % etot)

lib.logger.info(mf,'Write aom on AO basis to HDF5 file')
atom_dic = {'overlap':s}
lib.chkfile.save(name+'_integrals.h5', 'molecule', atom_dic)

#INFO: ******************** input file end ********************


System: ('Linux', 'cromo', '4.9.0-0.bpo.3-amd64', '#1 SMP Debian 4.9.30-2+deb9u5~bpo8+1 (2017-09-28)', 'x86_64', '')  Threads 4
Python 2.7.14 (default, Apr 10 2018, 19:21:27) 
[GCC 7.3.0]
numpy 1.15.4  scipy 1.2.0
Date: Thu Jan  3 03:28:01 2019
PySCF version 1.6
PySCF path  /home/jluis/src/pyscf/dev/pyscf
GIT ORIG_HEAD 21b86f213f74edcb007f36d31e83475226de7b3a
GIT HEAD      ref: refs/heads/dev
GIT dev branch  b2420273effddedd05459f6520b493977f9258d7

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_TMPDIR /scratch-ssd/jluis
[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 12
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry 1 subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 Li     0.000000000000   0.000000000000   1.175985000000 AA    0.000000000000   0.000000000000   2.222289576597 Bohr
[INPUT]  2 F      0.000000000000   0.000000000000  -0.391995000000 AA    0.000000000000   0.000000000000  -0.740763192199 Bohr

nuclear repulsion = 9.11222381333946
point group symmetry = Coov
num. orbitals of irrep A1 = 43
num. orbitals of irrep E1x = 27
num. orbitals of irrep E1y = 27
num. orbitals of irrep E2x = 15
num. orbitals of irrep E2y = 15
num. orbitals of irrep E3x = 7
num. orbitals of irrep E3y = 7
num. orbitals of irrep E4x = 2
num. orbitals of irrep E4y = 2
number of shells = 43
number of NR pGTOs = 187
number of NR cGTOs = 145
basis = /home/jluis/tmp/pyaim/sqzp.dat
ecp = {}
CPU time:         0.45


******** <class 'pyscf.dft.rks_symm.SymAdaptedRKS'> ********
method = SymAdaptedRKS-SymAdaptedRHF-RHF
initial guess = minao
damping factor = 0
level shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
DIIS start cycle = 1
DIIS space = 8
SCF tol = 1e-09
SCF gradient tol = None
max. SCF cycles = 150
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = lif.chk
max_memory 32000 MB (current use 74 MB)
XC functionals = rpw86,pbe
radial grids: 
    Treutler-Ahlrichs (JCP 102, 346 (M4)) radial grids
    
becke partition: Becke, JCP, 88, 2547 (1988)
pruning grids: <function nwchem_prune at 0x2b6615dbc230>
grids dens level: 3
symmetrized grids: 1
atomic radii adjust function: <function treutler_atomic_radii_adjust at 0x2b6615dbc140>
Freeze 0 electrons in irreps []
    12 free electrons in irreps A1 E1x E1y E2x E2y E3x E3y E4x E4y
Set gradient conv threshold to 3.16228e-05
tot grids = 26688
init E= -107.495679864774
HOMO (E1x) = -0.490744541093743  LUMO (A1) = -0.0961220299471643
cycle= 1 E= -107.524262716281  delta_E= -0.0286  |g|= 0.902  |ddm|= 0.794
HOMO (E1y) = -0.0185452387483427  LUMO (A1) = 0.0050856671727996
cycle= 2 E= -101.330644078884  delta_E= 6.19  |g|= 4.41  |ddm|=  2.3
HOMO (E1x) = -0.258843641318386  LUMO (A1) = -0.0489587891476665
cycle= 3 E= -107.651569708401  delta_E= -6.32  |g|= 0.315  |ddm|= 2.27
HOMO (E1x) = -0.215599040157378  LUMO (A1) = -0.0527072835590241
cycle= 4 E= -107.661005736016  delta_E= -0.00944  |g|= 0.0725  |ddm|= 0.128
HOMO (E1x) = -0.224631723606448  LUMO (A1) = -0.0548458267159601
cycle= 5 E= -107.661820532528  delta_E= -0.000815  |g|= 0.0217  |ddm|= 0.0332
HOMO (E1x) = -0.22740308362871  LUMO (A1) = -0.0553871469400581
cycle= 6 E= -107.661885259033  delta_E= -6.47e-05  |g|= 0.00711  |ddm|= 0.00754
HOMO (E1y) = -0.228363317985146  LUMO (A1) = -0.0554128625760532
cycle= 7 E= -107.661892727806  delta_E= -7.47e-06  |g|= 0.000716  |ddm|= 0.00312
HOMO (E1y) = -0.228439949955547  LUMO (A1) = -0.0553825193059624
cycle= 8 E= -107.661892802303  delta_E= -7.45e-08  |g|= 3.09e-05  |ddm|= 0.000319
HOMO (E1y) = -0.228433865416623  LUMO (A1) = -0.055380284087802
cycle= 9 E= -107.661892802469  delta_E= -1.67e-10  |g|= 1.64e-06  |ddm|= 2.7e-05
HOMO (E1x) = -0.22843318886725  LUMO (A1) = -0.0553800232070182
Extra cycle  E= -107.661892802468  delta_E= 1.22e-12  |g|= 3.22e-06  |ddm|= 2.65e-06
converged SCF energy = -107.661892802468
Rho = 11.999959380199
Population :    12.000000
Kinetic energy :   107.306132
Nuclear Atraction energy :  -276.443969
Nuclear Repulsion energy :     9.112224
Coulomb Pairs :   144.000000
XC Pairs :    12.000000
Pairs :   132.000000
J energy :    64.977588
XC energy :   -11.919492
EE energy :    53.058096
HF Total energy :  -106.967517
Ex :   -12.238767
Ec :    -0.375101
Exc :   -12.613868
DFT Total energy :  -107.661893
Write aom on AO basis to HDF5 file
